{% extends "base.html" %}

{% block content %}
  {{ super() }}

  <hr>

  {% if page.meta.author %}
    <div class="page-authors">
      本页作者：
      {% set authors = page.meta.author.split(',') %}
      {% for author in authors %}
        <a href="https://github.com/{{ author.strip() }}" target="_blank">
          {{ author.strip() }}
        </a>{% if not loop.last %}, {% endif %}
      {% endfor %}
    </div>
  {% endif %}

  <div class="page-license">
    若未特别说明，本站使用 SATA 与 CC BY-NC-SA 4.0。
  </div>

  <!-- <div id="giscus-container"></div> -->
  <script src="https://giscus.app/client.js"
        data-repo="Eternity-Sky/codeforces-problems-cn-translations"
        data-repo-id="R_kgDORNrtjg"
        data-category="Announcements"
        data-category-id="DIC_kwDORNrtjs4C2Rv6"
        data-mapping="pathname"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light_tritanopia" 
        data-lang="zh-CN"  
        crossorigin="anonymous"
        async>
</script>

<script>
  // ========= 轮询亮暗色 =========
  let lastTheme = null;

  function getGiscusTheme() {
    const meta = document.querySelector('meta[name="color-scheme"]');
    if (!meta) return "light_tritanopia";
    return meta.getAttribute("content") === "dark"
      ? "dark_dimmed"
      : "light_tritanopia";
  }

  function updateGiscusTheme() {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (!iframe || !iframe.contentWindow) return;

    const theme = getGiscusTheme();
    if (theme === lastTheme) return; // 未变化
    lastTheme = theme;

    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme } } },
      "https://giscus.app"
    );
  }

  function waitForGiscus() {
    const timer = setInterval(() => {
      const iframe = document.querySelector("iframe.giscus-frame");
      if (iframe && iframe.contentWindow) {
        updateGiscusTheme();
        clearInterval(timer);

        // 每 200ms 检查 meta，同步亮暗色
        setInterval(updateGiscusTheme, 200);
      }
    }, 200);
  }

  window.addEventListener("load", waitForGiscus);

  // ========= 页面加载时设置语言 =========
  window.addEventListener("DOMContentLoaded", () => {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (!iframe || !iframe.contentWindow) return;

    // 根据 <html lang=""> 判定语言
    const htmlLang = document.documentElement.lang;
    const lang = htmlLang === "en" ? "en" : "zh-CN";

    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { lang } } },
      "https://giscus.app"
    );
  });
</script>



      <!-- <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
      <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
      <script>
        var gitalk = new Gitalk({
  clientID: 'Ov23li4CqXkddudm4GQW',
  clientSecret: '3f27ba1e2e41b3bf71e6a5f0cb2c90e8d089f0aa',
  repo: 'codeforces-problems-cn-translations',
  owner: 'Eternity-Sky',
  admin: ['Eternity-Sky'],
  id: location.pathname,      // Ensure uniqueness and length less than 50
  distractionFreeMode: true,  // Facebook-like distraction free mode
  perPage: 50,
  pagerDirection: 'first',
  labels: ['Created by Gitalk', 'Comments']
})

gitalk.render('gitalk-container')
      </script> -->

{% endblock %}
