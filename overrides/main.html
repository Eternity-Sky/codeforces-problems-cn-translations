{% extends "base.html" %}

{% block content %}
  {{ super() }}

  <hr>

  {% if page.meta.author %}
    <div class="page-authors">
      æœ¬é¡µä½œè€…ï¼š
      {% set authors = page.meta.author.split(',') %}
      {% for author in authors %}
        <a href="https://github.com/{{ author.strip() }}" target="_blank">
          {{ author.strip() }}
        </a>{% if not loop.last %}, {% endif %}
      {% endfor %}
    </div>
  {% endif %}

  <div class="page-license">
    è‹¥æœªç‰¹åˆ«è¯´æ˜ï¼Œæœ¬ç«™ä½¿ç”¨ SATA ä¸ CC BY-NC-SA 4.0ã€‚
  </div>

  <div id="gitalk-container"></div>
  <script src="https://giscus.app/client.js"
        data-repo="CB-X2-Jun/codeforces-problems-cn-translations"
        data-repo-id="R_kgDORNrtjg"
        data-category="Announcements"
        data-category-id="DIC_kwDORNrtjs4C2Rv6"
        data-mapping="pathname"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light_tritanopia"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>

<script>
  // ä¸Šä¸€æ¬¡è®°å½•çš„ä¸»é¢˜
  let lastTheme = null;

  function getGiscusTheme() {
    const meta = document.querySelector('meta[name="color-scheme"]');
    if (!meta) return "light_tritanopia";
    return meta.getAttribute("content") === "dark"
      ? "dark_dimmed"
      : "light_tritanopia";
  }

  function updateGiscusTheme() {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (!iframe || !iframe.contentWindow) return;

    const theme = getGiscusTheme();
    if (theme === lastTheme) return; // ä¸»é¢˜æ²¡å˜å°±è·³è¿‡

    lastTheme = theme;

    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme } } },
      "https://giscus.app"
    );
  }

  function waitForGiscus() {
    const timer = setInterval(() => {
      const iframe = document.querySelector("iframe.giscus-frame");
      if (iframe && iframe.contentWindow) {
        updateGiscusTheme();
        clearInterval(timer);

        // ğŸ”¥ æ¯ 300ms æ£€æŸ¥ä¸€æ¬¡ metaï¼Œå®æ—¶åŒæ­¥ä¸»é¢˜
        setInterval(updateGiscusTheme, 200);
      }
    }, 200);
  }

  window.addEventListener("load", waitForGiscus);
  
  // è®¾ç½® giscus è¯­è¨€
  document.addEventListener("DOMContentLoaded", () => {
    const iframe = document.querySelector("iframe.giscus-frame");
    if (!iframe) return;

    // æ ¹æ® URL åˆ¤æ–­è¯­è¨€
    const lang = window.location.pathname.startsWith("/en/") ? "en" : "zh-CN";

    // å‘é€æ¶ˆæ¯æ›´æ–°è¯­è¨€
    iframe.contentWindow.postMessage(
      {
        giscus: {
          setConfig: {
            lang: lang
          }
        }
      },
      "https://giscus.app"
    );
  });
</script>


      <!-- <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
      <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
      <script>
        var gitalk = new Gitalk({
  clientID: 'Ov23li4CqXkddudm4GQW',
  clientSecret: '3f27ba1e2e41b3bf71e6a5f0cb2c90e8d089f0aa',
  repo: 'codeforces-problems-cn-translations',
  owner: 'CB-X2-Jun',
  admin: ['CB-X2-Jun'],
  id: location.pathname,      // Ensure uniqueness and length less than 50
  distractionFreeMode: true,  // Facebook-like distraction free mode
  perPage: 50,
  pagerDirection: 'first',
  labels: ['Created by Gitalk', 'Comments']
})

gitalk.render('gitalk-container')
      </script> -->

{% endblock %}
